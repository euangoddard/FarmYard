!function(n){"use strict";n.module("menagerie.constants",[]).constant("ANIMALS",["cat","chicken","cockerel","cow","dog","donkey","elephant","fox","swipe","tap","horse","leopard","lion","lioness","monkey","orangutan","owl","panda","penguin","pig","puma","reindeer","sheep","tiger","zebra"])}(window.angular,window._),function(n,e){"use strict";var o={cat:"Meow",chicken:"Cluck",cockerel:"Cock-a-doodle-doo",cow:"Moo",dog:"Woof",donkey:"Eee-aww",elephant:"Trump",fox:"Bark",horse:"Neigh",leopard:"Growl",lion:"Roar",lioness:"Roar",monkey:"Screech",orangutan:"Ooo-ooh",owl:"Hoot",panda:"Growl",penguin:"Squawk",pig:"Oink",puma:"Growl",reindeer:"Awww",sheep:"Baaa",tiger:"Growl",zebra:"Whinny"},i=e.keys(o),t={37:-1,39:1},r=n.module("Menagerie",["ngAnimate","ngTouch"]);r.config(["$compileProvider","SoundManagerProvider","ImagePreloaderProvider",function(n,e,o){n.debugInfoEnabled(!1);var i=a("sounds-root");e.set_sounds_root(i);var t=a("images-root");o.set_images_root(t)}]),r.controller("MenagerieCtrl",["$scope","$q","SoundManager","ImagePreloader","HelpQueue",function(o,r,a,u,c){var d=a.add_sounds(i),s=u.load_images(i,"svg");r.all([d,s]).then(function(){o.is_loading=!1}),o.is_loading=!0;var l={};o.position=0,o.animals=[],this.move=function(n){o.position+=n;var i=o.position,t=l[i];if("undefined"==typeof t){var r=p(i);l[i]=t=e.sample(r)}o.animals.splice(0,1,t),c.purge("swipe").purge("tap")};var p=function(n){var o=[l[n-1],l[n-2],l[n+1],l[n+2]],t=e.difference(i,o);return t},f=this,g=n.element(document);g.on("keydown",function(n){var e=t[n.keyCode];e&&o.$apply(function(){f.move(e)})}),o.$on("$destroy",function(){g.off("keydown")}),this.move(0),c.add("swipe",15e3)}]),r.directive("animal",function(){return{restrict:"EA",scope:{name:"=animal"},templateUrl:a("partials-root")+"animal.html",controller:["$scope","vibration","SoundManager","HelpQueue",function(n,e,i,t){n.is_speaking=!1,this.speak=function(){n.is_speaking=!0,e.vibrate(200),i.play(n.name).then(function(){n.is_speaking=!1}),t.purge("tap")},n.$watch("name",function(e){n.is_speaking=!1,n.sound=o[e]}),t.add("tap",5e3)}],controllerAs:"animal_ctrl"}}),r.factory("HelpQueue",["$timeout","$rootScope",function(n,o){var i,t=[],r=null,a=function(){if(!r||!r.id){var c=t.shift();e.isUndefined(c)||(i=n(function(){o.$broadcast("help:show",c.id),u(),a()},c.delay),r=c)}},u=function(){i=null,r=null};return{add:function(n,e){return t.push({id:n,delay:e}),a(),this},purge:function(a){var c=e.findIndex(t,{id:a});return o.$broadcast("help:hide",a),-1!==c?t.splice(c,1):r&&r.id===a&&(n.cancel(i),u()),this}}}]),r.controller("HelpCtrl",["$scope",function(n){n.is_help_required={},this.end_help=function(e){n.is_help_required[e]=!1},n.$on("help:show",function(e,o){n.is_help_required[o]=!0}),n.$on("help:hide",function(e,o){n.is_help_required[o]=!1})}]),r.directive("onAnimationEnd",function(){return{restrict:"A",scope:{onAnimationEnd:"&"},link:function(n,e){e.on("webkitAnimationEnd animationend",function(e){n.$apply(function(){n.onAnimationEnd(e)})})}}}),r.factory("vibration",function(){var e=n.isFunction(navigator.vibrate);return e?{vibrate:function(){return navigator.vibrate(Array.prototype.slice.call(arguments,0))},stop:function(){return navigator.vibrate(0)}}:{vibrate:n.noop,stop:n.noop}}),r.provider("SoundManager",function(){var e={},o="/",i=Modernizr.audio.ogg?"ogg":"m4a";window.AudioContext=window.AudioContext||window.webkitAudioContext;var t=new AudioContext;this.set_sounds_root=function(n){return o=n,this};var r=function(n){return o+n+"."+i};this.$get=["$q",function(o){var i=function(n){var i=r(n),a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer";var u=o(function(o){a.onload=function(){t.decodeAudioData(a.response,function(i){e[n]=i,o(n)})}});return a.send(),u};return{play:function(n){var i=o(function(o){var i=e[n],r=t.createBufferSource();r.buffer=i,r.connect(t.destination),r.onended=o,r.start(0)});return i},add_sounds:function(e){var t=[];return n.forEach(e,function(n){t.push(i(n))}),o.all(t)}}}]}),r.provider("ImagePreloader",function(){var e="/";this.set_images_root=function(n){return e=n,this},this.$get=["$q",function(o){var i=function(n,i){var t=e+n+"."+i,r=new Image,a=o(function(n){r.onload=function(){n(r)}});return r.src=t,a};return{load_images:function(e,t){var r=[];return n.forEach(e,function(n){r.push(i(n,t))}),o.all(r)}}}]});var a=function(n){var e=document.body.getAttribute("data-"+n);return e}}(window.angular,window._);